<div id="product_details" class="">
    <div class="col-md-8 mt-2 container-main">
        <div class="left-half">
            <div>
                <h4><strong>Profile Details</strong></h4>
                {{{debug user}}}
                <div class="cart">
                    <div class="cart-body">
                        <div class="cart-items">
                            <div class="mt-2">
                                <img src="{{product_info.thumbnail.url}}" width="100">
                            </div>
                            <div class="items-cart">
                                <div class="mt-2">
                                    <span>Name: </span><strong>{{user.name}}</strong>
                                </div>
                                <div class="mt-2">
                                    <span>Mobile: </span><strong>{{user.mobile}}</strong>
                                </div>
                                <div class="mt-2">
                                    <span>Email: </span><strong>{{user.email}}</strong>
                                </div>
                            </div>
                            <div>
                            	<label class="inline-flex items-center mt-3">
			                        <span style="display: flex; cursor: pointer;" id="userEdit" class="ml-2 text-gray-700 mb-4">
			                        	<i class='bx bx-edit bx-sm' ></i></span>
			                    </label>
                                <a style="display:flex;" class="" data-href=""></a>
                            </div>
                        </div>
                        <form id="user_form" method="POST">
			                    <div class="cart-item form-group">
			                         <div class="mt-2">
			                           <input type="text" value="{{user.name}}" id="name" name="name" class="form-control" placeholder="Enter your name">
			                        </div>
			                        <div class="mt-2">
			                           <input type="text" value="{{user.email}}" id="email" name="email" class="form-control" placeholder="Enter your email">
			                        </div>
			                        <div class="mt-2">
			                           <input type="text" value="{{user.mobile}}" id="mobilenumber" name="mobile" class="form-control" placeholder="Enter your mobile number">
			                        </div>
			                    </div>
			                    <div style="padding-top:20px;">
				                    <button type="submit" class="btn bg-cart-buy ">
					                    Update
					                </button>
			                    </div>
		                    </form>
                    </div>
                </div>
                   
            </div>
            <div style="padding-top: 20px;">
                <h4><strong>Delivery Address</strong></h4>
                {{#if address}}
                  	{{#each address}}
                  		{{#if isDefault}}
                  			<div class="cart">
		                        <div class="cart-body">
		                        		<div style="text-align: right;">
		                        		<label>
		                        			<span class="ml-2 text-gray-700 mb-4">{{#if isDefault}} Default Address{{else}} Set as a default{{/if}}</span>
		                        			
	                        			</label>
		                        		</div>
		                            <div class="cart-items">
		                                <div class="mt-2">
		                                   {{address}} , {{address1}}
		                                   <br>
		                                   {{city}} - {{mobile}}
		                                </div>
		                            </div>
		                        </div>
		                	</div>
		                {{/if}}
                  	{{/each}}
                {{/if}}
            </div>
        </div>
        <div class="right-half">
            <div style="margin:20px">
                <p>List Of Address</p>
            </div>
            <div>
                <div style="margin:20px; height: 600px;" class="scrollbar" id="style-4">
                	{{#if address}}
                  		{{#each address}}
                  			<div class="cart">
		                        <div class="cart-body">
		                        		<div style="text-align: right;">
		                        		<label>
		                        			<span class="ml-2 text-gray-700 mb-4">{{#if isDefault}} Default Address{{else}} Set as a default{{/if}}</span>
		                        			<input type="radio" id="addressSelect" name="payment" {{#if isDefault}} checked {{/if}} value="{{_id}}" class=" addressSelect form-radio h-5 w-5 text-gray-600 mb-4">
	                        			</label>
		                        		</div>
		                            <div class="cart-items">
		                                <div class="mt-2">
		                                   {{address}} , {{address1}}
		                                   <br>
		                                   {{city}} - {{mobile}}
		                                </div>
		                            </div>
	                  				
		                        </div>
		                	</div>
                  		{{/each}}
                	{{/if}}
                </div>
               
            </div>
            <div>
                 <div class="flex-col mb-4"  style="margin:20px">
                    <label class="inline-flex items-center mt-3">
                        <span style="display: flex; cursor: pointer;" id="addressNew" class="ml-2 text-gray-700 mb-4"><i class='bx bx-plus bx-sm' ></i>Add new address</span>
                    </label>
                </div>
           
                <div class="cart-body" id="addressForm">
                	<form id="address_form" method="POST">
	                    <div class="cart-item form-group">
	                         <div class="mt-2">
	                           <input type="text" id="mobile" name="mobile" class="form-control" placeholder="Enter your mobile number">
	                        </div>
	                        <div class="mt-2">
	                           <input type="text" id="address" name="address" class="form-control" placeholder="Enter your delivery address">
	                        </div>
	                        <div class="mt-2">
	                           <input type="text" id="address1" name="address1" class="form-control" placeholder="Enter your delivery area / Colony / road name">
	                        </div>
	                        <div class="mt-2">
	                           <input type="text" id="city" name="city" class="form-control" placeholder="Enter your delivery city">
	                        </div>
	                        <div class="mt-2">
	                           <input type="text" id="pincode" name="pincode" class="form-control" placeholder="Enter your delivery pincode">
	                        </div>
	                    </div>
	                    <div class="flex flex-col mb-4 form-group">
	                        <label class="inline-flex items-center mt-3">
	                            <span class="ml-2 text-gray-700 mb-4">Default address</span>
	                            <input type="radio" id="defaultaddress" name="defaultaddress" value="true" class=" form-radio h-5 w-5 text-gray-600 mb-4">
	                        </label>
	                        <label class="inline-flex items-center mt-3">
	                            <span class="ml-2 text-gray-700 mb-4">Use for later</span>
	                            <input type="radio" id="defaultaddress1" name="defaultaddress" checked value="false" class="form-radio h-5 w-5 text-gray-600 mb-4">
	                        </label>
	                    </div>
	                    <div style="padding-top:20px;">
		                    <button type="submit" class="btn bg-cart-buy ">
			                    Continue
			                </button>
	                    </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    // $('#addressNew').on( "click", (e) => { 
    // 	document.getElementById('addressForm').style.display = 'block' 
    // })

    $(document).ready(function() {
	  $("#addressNew").click(function() {
	    $("#addressForm").toggle();
	  });

	  $("#userEdit").click(function() {
	    $("#user_form").toggle();
	  });

	});
    
    $('.addressSelect').on( "click", (e) => {
    	let addressId = e.target.value.replace("'",'');

    	$.ajax({
            url: '/user/profile/address/default',
            dataType: "html",
            method:'POST',
            data:{addressId},
            success: function (response) {
                $(".bodyDiv").html(response);
            },
            error: function (xhr, status, error) {
                toastr["error"](error, "error", {
                    "closeButton": true,
                    "progressBar": true
                });
            }
        });
    })

    $(document).ready(function () {
		//validate form
		$('form#address_form').validate({
			errorClass: "state-error",
			validClass: "state-success",
			rules: {
				mobile: {
                    required: true,
                    digits: true,
                    minlength: 10,
                    maxlength: 10
                },
			},
			messages: {
				mobile: {
                    required: 'Required!',
                    digits: 'Only digits!',
                    minlength: 'minumim 10 digits!',
                    maxlength: 'mixumim 10 digits!',
                },
			},
			highlight: function (element, errorClass, validClass) {
				$(element).closest('.form-group').addClass(errorClass).removeClass(validClass);
			},
			unhighlight: function (element, errorClass, validClass) {
				$(element).closest('.form-group').removeClass(errorClass).addClass(validClass);
			},
			errorPlacement: function (error, element) {
				if ($(element).attr('type') == 'checkbox') {
					error.insertAfter(element.parent());
				} else {
					error.insertAfter(element);
				}
			},
		});

		$('form#user_form').validate({
			errorClass: "state-error",
			validClass: "state-success",
			rules: {
				name: {
                    required: true,
                },
                email: {
                    required: true,
                    email: true,
                },
                mobile: {
                    required: true,
                    digits: true,
                    minlength: 10,
                    maxlength: 10
                },
			},
			messages: {
				name: {
                    required: 'Required!',
                },
                email: {
                    required: 'Required!',
                },
                email: {
                    required: 'Required!',
                    email: 'Not valid!'
                },
                mobile: {
                    required: 'Required!',
                    digits: 'Only digits!',
                    minlength: 'minumim 10 digits!',
                    maxlength: 'mixumim 10 digits!',
                },
			},
			highlight: function (element, errorClass, validClass) {
				$(element).closest('.form-group').addClass(errorClass).removeClass(validClass);
			},
			unhighlight: function (element, errorClass, validClass) {
				$(element).closest('.form-group').removeClass(errorClass).addClass(validClass);
			},
			errorPlacement: function (error, element) {
				if ($(element).attr('type') == 'checkbox') {
					error.insertAfter(element.parent());
				} else {
					error.insertAfter(element);
				}
			},
		});
	});

    $(document).ready(function () {
		$("#address_form").submit(function (event) {
		    var formData = {
		      mobile: $("#mobile").val(),
		      address: $("#address").val(),
		      address1: $("#address1").val(),
		      city: $("#city").val(),
		      pincode: $("#pincode").val(),
		      defaultaddress: $("#defaultaddress").val(),
		    };
		    
		    $.ajax({
	            url: '/user/profile',
	            dataType: "html",
	            method:'POST',
	            data:formData,
	            success: function (response) {
	                $(".bodyDiv").html(response);
	            },
	            error: function (xhr, status, error) {
	                toastr["error"](error, "error", {
	                    "closeButton": true,
	                    "progressBar": true
	                });
	            }
        	});

		    event.preventDefault();
		});

		$("#user_form").submit(function (event) {
		    var formData = {
		      mobile: $("#mobilenumber").val(),
		      name: $("#name").val(),
		      email: $("#email").val(),
		    };
		    
		    $.ajax({
	            url: '/user/profile/update',
	            method:'POST',
	            data:formData,
	            success: function (response) {
	            	if(response.success) {
	            		$.notify("Profile updated!", "success")
	            		$.ajax({
	            			url:'/user/profile',
				            dataType: "html",
				            success: function (response) {
				                $(".bodyDiv").html(response);
				            },
				            error: function (xhr, status, error) {
				                toastr["error"](error, "error", {
				                    "closeButton": true,
				                    "progressBar": true
				                });
				            }
				        });
	            	} else {
	            		$.notify(response.message, "error")
	            	}
	               // $(".bodyDiv").html(response);
	            },
	            error: function (xhr, status, error) {
	                toastr["error"](error, "error", {
	                    "closeButton": true,
	                    "progressBar": true
	                });
	            }
        	});

		    event.preventDefault();
		});
	});

</script>


